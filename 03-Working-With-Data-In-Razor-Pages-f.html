<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Working with Data in Razor Pages</title>
<link href="assets/css/bootstrap.css" rel="stylesheet">
<!-- Custom styles for this template -->
<link href="assets/css/starter-template.css" rel="stylesheet">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=css&amp;skin=sunburst"></script>
<style type="text/css">
html {
	font-size: 90.0%;
}

h2 {
	margin-top: 60px;
}

h4, h3 {
	padding-top: 40px!;		
}

p {
	font-size: 1.2em;
}
h4 {
	font-size: 1.4em;
}

img, pre.prettyprint {
	margin-top: 1.5em;
	margin-bottom: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
    color:#007bff;

}
blockquote {
    border-left: 4px solid #999;
    padding-left: 1rem;
    page-break-inside: avoid;
}
:target:before {
  content: "";
  display: block;
  height: 80px; /* adjust this value to your needs */
  margin: -80px 0 0; /* this should be a negative value of the height above */
}
</style>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
</head>
<body>
<header>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">LinkedIn - ASP.NET Core Razor Pages</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">Home</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Working with Data in Razor Pages <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<div class="container">
    <div class="starter-template">

<h1 id="working-with-data-in-razor-pages">Working with Data in Razor Pages</h1>
<p>Code: <code>Sandbox\Razor\MovieApp</code></p>
<p><strong>Note:</strong> in these code examples we are not going to use <code>scaffolding</code> to build our pages. All the HTML and code will be added manually.</p>
<h2 id="adding-entity-framework">Adding Entity Framework</h2>
<h3 id="steps">Steps</h3>
<ol>
<li>Create new database</li>
<li>Get connection string</li>
<li>Configure Entity Framework Core</li>
</ol>
<h3 id="nuget-packages">NuGet packages</h3>
<ul>
<li>Microsoft.EntityFrameworkCore</li>
<li>Microsoft.EntityFrameworkCore.SqlServer</li>
<li>Microsoft.EntityFrameworkCore.Tools</li>
</ul>
<h3 id="create-sql-server-database">Create SQL Server database</h3>
<p>In Visual Studio go to <code>Server Explorer</code> and add a new database. It will ask for the Server name (<code>TIGER</code>) and we want to use <em>Windows Authentication</em>.</p>
<p>In <em>Connect to a database</em> name it <code>MovieApp</code>.</p>
<p>Click <code>Ok</code>.</p>
<p>In the Server Explorer data connection you will see.</p>
<pre class="prettyprint"><code><div>    tiger.MovieApp.dbo
</div></code></pre>
<p>Right-Click the <code>MovieApp</code> database and look at <em>Properties</em> you will see a <em>Connection string</em> so copy this.</p>
<p>To store the connection string use the <code>appsettings.json</code> file.</p>
<pre class="prettyprint"><code><div>    {
      <span class="hljs-attr">"Logging"</span>: {
        <span class="hljs-attr">"LogLevel"</span>: {
          <span class="hljs-attr">"Default"</span>: <span class="hljs-string">"Information"</span>,
          <span class="hljs-attr">"Microsoft.AspNetCore"</span>: <span class="hljs-string">"Warning"</span>
        }
      },
      <span class="hljs-attr">"AllowedHosts"</span>: <span class="hljs-string">"*"</span>,
      <span class="hljs-attr">"ConnectionStrings"</span>: {
        <span class="hljs-attr">"MovieApp"</span>: <span class="hljs-string">"Data Source=TIGER;Initial Catalog=MovieApp;Integrated Security=True"</span>
      }
    }
</div></code></pre>
<p><strong>Note:</strong> you can add multiple connection strings in here, each separated by a comma.</p>
<h3 id="add-nuget-packages">Add NuGet packages</h3>
<p>Open the NuGet console.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-built_in">Install-Package</span> Microsoft.EntityFrameworkCore
    
    <span class="hljs-built_in">Install-Package</span> Microsoft.EntityFrameworkCore.SqlServer

    <span class="hljs-built_in">Install-Package</span> Microsoft.EntityFrameworkCore.Tools
</div></code></pre>
<h3 id="create-the-dbcontext">Create the DbContext</h3>
<p>In the <code>Data</code> folder create a new class named <code>MovieAppDbContext.cs</code>. This class is going to serve as the translator between the SQL and our entities.</p>
<p>In the class we need to inherit from the base class <code>DbContext</code>.</p>
<p>Add the using statement <code>using Microsoft.EntityFrameworkCore;</code>.</p>
<p>Create a <code>ctor</code> constructor named <code>MovieAppDbContext()</code>.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Data</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MovieAppDbContext</span>: <span class="hljs-title">DbContext</span>
        {
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieAppDbContext</span>(<span class="hljs-params">DbContextOptions&lt;MovieAppDbContext&gt; options</span>): <span class="hljs-title">base</span>(<span class="hljs-params">options</span>)</span>
            {

            }

            <span class="hljs-keyword">public</span> DbSet&lt;Movie&gt; Movies { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        }
    }
</div></code></pre>
<p><strong>Note:</strong> don't forget to make <code>DbSet&lt;Movie&gt; Movies { get; set; }</code> <strong>public</strong>.</p>
<p>We have injected the <code>DbContextOptions</code> into our constructor and we need to add C# class <code>MovieAppDbContext</code> and name it <code>options</code> which inherits from <code>base(options)</code>.</p>
<p>We also need to create a <code>DbSet&lt;&gt;</code> and this will be used by Entity Framework Core to create the table in our database which will be derived from our <code>Movie</code> model. We import the Namespace from Movie (<code>MoviesApp.Data.Models</code>). The table name will be <code>Movies</code> and we need to <code>get</code> and <code>set</code> data to and from the database.</p>
<p>Now we need to configure our context to be able to work with the Entity Framework Core and the SQL Server database. To do this we need to go to the <code>Program.cs</code> class file and add the following statement below the <code>AddRazorPages()</code> statement.</p>
<pre class="prettyprint"><code><div>    builder.Services.AddDbContext&lt;MovieAppDbContext&gt;(options =&gt; 
        options.UseSqlServer(builder.Configuration.GetConnectionString(<span class="hljs-string">"MovieApp"</span>)));
</div></code></pre>
<p>We add a <code>builder.Services.AddDbContext</code> and use the <code>MovieAppDbContext</code> context. In our options we need to tell the services that we are using <code>SqlServer</code>. To access our connection string we use <code>builder.Configuration.GetConnectionString</code> to get the configuration string with our reference to the <code>MovieApp</code> connection string from <code>appsettings.json</code>.</p>
<h3 id="adding-a-migration">Adding a migration</h3>
<p><strong>Note:</strong> don't do this section if you already have an existing database and tables.</p>
<p>This will build the database for us using Entity Framework Core and SQL Server.</p>
<p><strong>Note:</strong> before you run the following you should compile your project and make sure you have no compile errors.</p>
<p>Go to the NuGet console.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-built_in">Add-Migration</span> Initial
</div></code></pre>
<p>Where <code>Initial</code> is the name of the migration.</p>
<p>This creates the database.</p>
<p>If you look in the migrations folder you will see <code>20220720063743_Initial.cs</code> which is the script to create the table in our database. To do this run the following NuGet command.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-built_in">Update-Database</span>
</div></code></pre>
<p>This creates the <code>Movie</code> table.</p>
<p>In the Server Explorer in Visual Studio go to the database and open the tables. You will see the <code>Movie</code> table. From here you can <code>Show Table Data</code> to see if there is any table rows. In our case there won't be.</p>
<h2 id="adding-and-storing-data-in-a-database">Adding and storing data in a database</h2>
<p>We are going to add a new <code>Movie</code> into the database.</p>
<p>In our <code>AddMovie</code> PageModel we need to create a constructor and add our database context.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">private</span> MovieAppDbContext _context;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddMovieModel</span>(<span class="hljs-params">MovieAppDbContext context</span>)</span>
    {
        _context = context;
    }
</div></code></pre>
<p>Now, in our <code>OnPost()</code> method we create a new <code>Movie</code> object to save the data that has been posted.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnPost</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">string</span> <span class="hljs-keyword">value</span> = <span class="hljs-string">$"<span class="hljs-subst">{Movie.Title}</span> - <span class="hljs-subst">{Movie.Rate}</span>/10 - <span class="hljs-subst">{Movie.Description}</span>"</span>;
        
        <span class="hljs-keyword">if</span> (!ModelState.IsValid)
        {
            <span class="hljs-keyword">return</span> Page();
        }

        Message = <span class="hljs-keyword">value</span>;
        
        <span class="hljs-keyword">var</span> movie = <span class="hljs-keyword">new</span> Movie()
        {
            Title = Movie.Title,
            Rate = Movie.Rate,
            Description = Movie.Description
        };
        
        _context.Movies.Add(movie);
        _context.SaveChanges();
        
        <span class="hljs-keyword">return</span> Redirect(<span class="hljs-string">"Movies"</span>);
    }
</div></code></pre>
<p>Once we have added our data to our <code>Movie</code> object add it to the context, <code>_context.Movies.Add(movie)</code> and save the changes to the database with <code>_context.SaveChanges()</code>.</p>
<p>We can now use server explorer to view our <code>Movie</code> table and we see that it has saved a record.</p>
<p><img src="assets/images/save-to-database.jpg" alt="Add a row to the table" title="Add a row to the table"></p>
<p>We are then redirected to the <code>Movies</code> page. We don't see the new <code>Movie</code> object on the page because the data is hardcoded. That will be our next task.</p>
<h2 id="getting-data-from-a-database">Getting data from a database</h2>
<p>To be able to see the data in our <code>Movies</code> list go to <code>Movies.cshtml.cs</code>. Remove the hardcoded data from the <code>OnGet()</code> method.</p>
<h3 id="moviescshtmlcs">Movies.cshtml.cs</h3>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoviesModel</span> : <span class="hljs-title">PageModel</span>
        {
            <span class="hljs-keyword">public</span> List&lt;Movie&gt;? Movies { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            [<span class="hljs-meta">TempData</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> MovieAppDbContext _context;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MoviesModel</span>(<span class="hljs-params">MovieAppDbContext context</span>)</span>
            {
                _context = context;
            }

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"></span>)</span>
            {
                Movies = _context.Movies.ToList();
            }
        }
    }
</div></code></pre>
<p>We add a constructor to get the context and then use <code>_context.Movies.ToList()</code> to pass back a list of <code>Movies</code>.</p>
<p>Now run the application again and we will see that there is one Movie in our <code>Movies</code> Razor page.</p>
<p><img src="assets/images/movies-list-from-database.jpg" alt="Movies list" title="Movies list"></p>
<p>Add some more movies to see them in the list.</p>
<p><img src="assets/images/more-movies-added.jpg" alt="Movies list" title="Movies list"></p>
<h2 id="getting-data-by-id-from-the-database">Getting data by ID from the database</h2>
<p>Now we are going to get a single movie from the database by using the <strong>Id</strong>.</p>
<p>First add the MovieAppDbContext. Don't forget to add the MovieAppDbContext namespace, <code>using MoviesApp.Data;</code>.</p>
<p>Also add the Movie class so we can store an individual movie and import the <code>Models</code> namespace.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MovieModel</span> : <span class="hljs-title">PageModel</span>
    {
        [<span class="hljs-meta">BindProperty</span>]
        <span class="hljs-keyword">public</span> Movie? Movie { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

        <span class="hljs-keyword">private</span> MovieAppDbContext _context;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieModel</span>(<span class="hljs-params">MovieAppDbContext context</span>)</span> =&gt; _context = context;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"></span>)</span>
        {
        }
    }
</div></code></pre>
<p>In The <code>OnGet()</code> method we to get the <strong>Movie</strong> based on its <strong>Id</strong>.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id</span>)</span>
    {
        Movie = _context.Movies.FirstOrDefault(n =&gt; n.Id == id);
    }
</div></code></pre>
<p>Where are we going to get the <strong>Id</strong> from?</p>
<p>Go to the Movie.cshtml page and on the top of the page is the page directive.</p>
<pre class="prettyprint"><code><div>    @page &quot;{id:int}&quot;
</div></code></pre>
<p>We have added the <code>{id}</code> and the <strong>Id</strong> is going to be part of the Razor Page route. You can also define the type as <code>int</code>.</p>
<p><strong>Note:</strong> the <code>id</code> value in the page has to be the same identical value as used in the <code>OnGet()</code> method.</p>
<h3 id="final-moviecshtmlcs-code">final Movie.cshtml.cs code</h3>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MovieModel</span> : <span class="hljs-title">PageModel</span>
        {
            [<span class="hljs-meta">BindProperty</span>]
            <span class="hljs-keyword">public</span> Movie? Movie { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> MovieAppDbContext _context;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieModel</span>(<span class="hljs-params">MovieAppDbContext context</span>)</span> =&gt; _context = context;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id</span>)</span>
            {
                Movie = _context.Movies.FirstOrDefault(n =&gt; n.Id == id);
            }
        }
    }
</div></code></pre>
<p>Now, we have to remove the hard coded data in the cshtml page.</p>
<pre class="prettyprint"><code><div>    &lt;div class=&quot;card-body&quot;&gt;
        &lt;h5 class=&quot;card-title&quot;&gt;Special title treatment&lt;/h5&gt;
        &lt;p class=&quot;card-text&quot;&gt;8/10&lt;/p&gt;
        &lt;p class=&quot;card-text&quot;&gt;With supporting text below as a natural lead-in to additional content.&lt;/p&gt;
        &lt;a href=&quot;/Movies&quot; class=&quot;btn btn-primary&quot;&gt;Show all&lt;/a&gt;
    &lt;/div&gt;
</div></code></pre>
<p>Change to.</p>
<pre class="prettyprint"><code><div>    &lt;div class=&quot;card-body&quot;&gt;
        &lt;h5 class=&quot;card-title&quot;&gt;@Model.Movie?.Title&lt;/h5&gt;
        &lt;p class=&quot;card-text&quot;&gt;@Model.Movie?.Rate/10&lt;/p&gt;
        &lt;p class=&quot;card-text&quot;&gt;@Model.Movie?.Description&lt;/p&gt;
        &lt;a href=&quot;/Movies&quot; class=&quot;btn btn-primary&quot;&gt;List&lt;/a&gt;
    &lt;/div&gt;
</div></code></pre>
<p><strong>Note:</strong> we add the question marks to get rid of the possible null value message.</p>
<p>When you test the Movie page you will note the <strong>url</strong> has got the <code>id</code> value in it.</p>
<blockquote>
<p><a href="https://localhost:7008/Movie/4">https://localhost:7008/Movie/4</a></p>
</blockquote>
<p>In this case an <code>id</code> of 4.</p>
<p><img src="assets/images/movie-by-id.jpg" alt="Movie by Id" title="Movie by Id"></p>
<h2 id="adding-a-custom-url">Adding a custom url</h2>
<p>You can create your own custom url for a page if you want.</p>
<p>In our case we will test this with.</p>
<pre class="prettyprint"><code><div>    @page &quot;Details/{id:int}&quot;
</div></code></pre>
<p>We can test this with the following url.</p>
<blockquote>
<p><a href="https://localhost:7008/Movie/Details/4">https://localhost:7008/Movie/Details/4</a></p>
</blockquote>
<p><img src="assets/images/movie-details.jpg" alt="Movie details" title="Movie details"></p>
<p>Now, change it back by removing the <code>Details</code> route.</p>
<p>As a final change in the Movie header add the <code>Id</code>.</p>
<h3 id="final-moviecshtml-code">final Movie.cshtml code</h3>
<pre class="prettyprint"><code><div>    @page &quot;{id:int}&quot;
    @model MoviesApp.Pages.MovieModel
    
    @{
        ViewData[&quot;Title&quot;] = &quot;Movie details&quot;;
    }
    
    &lt;h3&gt;@ViewData[&quot;Title&quot;]&lt;/h3&gt;
    &lt;hr /&gt;

    &lt;div class=&quot;card&quot;&gt;
        &lt;div class=&quot;card-header&quot;&gt;
            Movie - @Model.Movie.Id
        &lt;/div&gt;
        &lt;div class=&quot;card-body&quot;&gt;
            &lt;h5 class=&quot;card-title&quot;&gt;@Model.Movie?.Title&lt;/h5&gt;
            &lt;p class=&quot;card-text&quot;&gt;@Model.Movie?.Rate/10&lt;/p&gt;
            &lt;p class=&quot;card-text&quot;&gt;@Model.Movie?.Description&lt;/p&gt;
            &lt;a href=&quot;/Movies&quot; class=&quot;btn btn-primary&quot;&gt;List&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
</div></code></pre>
<h2 id="adding-a-service">Adding a Service</h2>
<p>So far you have learned how to add and get data from the <code>MoviesApp</code> database. In all cases you have had to inject the <code>MovieAppDbContext</code> context that is configured to use a SQL database. This is not a good practice especially if you don't want to be dependent on SQL Server. It is better to create a service and do the database calls from this service. Then instead of injecting the Movie App context you can inject the service.</p>
<p>This is what we are going to learn how to do.</p>
<h3 id="steps">Steps</h3>
<ol>
<li>Add a service.</li>
<li>Inject a service.</li>
<li>Configure a service.</li>
</ol>
<p>Create a <strong>Services</strong> folder in the root of the project.</p>
<p>Add an <strong>IMoviesService</strong> interface in this folder.</p>
<p>Add an <strong>MoviesService</strong> class in this folder.</p>
<h4 id="imoviescs">IMovies.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Services</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IMoviesService</span>
        {
            <span class="hljs-function">List&lt;Movie&gt; <span class="hljs-title">GetAll</span>(<span class="hljs-params"></span>)</span>;
            <span class="hljs-function">Movie <span class="hljs-title">Get</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id</span>)</span>;

            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Add</span>(<span class="hljs-params">Movie movie</span>)</span>;
        }
    }
</div></code></pre>
<p>Now go to the <code>MoviesService.cs</code> class and inherit from <strong>IMoviesService</strong> and as soon as you do this it will fill out the methods for you.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Services</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoviesService</span> : <span class="hljs-title">IMoviesService</span>
        {
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Add</span>(<span class="hljs-params">Movie movie</span>)</span>
            {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
            }

            <span class="hljs-function"><span class="hljs-keyword">public</span> Movie <span class="hljs-title">Get</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id</span>)</span>
            {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
            }

            <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Movie&gt; <span class="hljs-title">GetAll</span>(<span class="hljs-params"></span>)</span>
            {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
            }
        }
    }
</div></code></pre>
<p>Now we are at the stage where we can fill in each method. First add a constructor (<code>ctor</code>) and then fill in each of the methods.</p>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Services</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoviesService</span> : <span class="hljs-title">IMoviesService</span>
        {
            <span class="hljs-keyword">private</span> MovieAppDbContext _context;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MoviesService</span>(<span class="hljs-params">MovieAppDbContext context</span>)</span> =&gt; _context = context;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Add</span>(<span class="hljs-params">Movie movie</span>)</span>
            {
                _context.Movies.Add(movie);
                _context.SaveChanges();
            }

            <span class="hljs-keyword">public</span> Movie? Get(<span class="hljs-keyword">int</span> id) =&gt; _context.Movies.FirstOrDefault(n =&gt; n.Id == id);

            <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Movie&gt; <span class="hljs-title">GetAll</span>(<span class="hljs-params"></span>)</span> =&gt; _context.Movies.ToList();
        }
    }
</div></code></pre>
<p>To stop nullable error messages add a question mark to the <code>Get()</code> method and also go back to the <strong>IMoviesService.cs</strong> code and add a question mark there as well.</p>
<pre class="prettyprint"><code><div>    Movie? Get(<span class="hljs-keyword">int</span> id);
</div></code></pre>
<p>Now in all of our Movie pages we have to inject the services instead of the context (MovieAppDbContext).</p>
<h4 id="moviecshtmlcs">Movie.cshtml.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;
    <span class="hljs-keyword">using</span> MoviesApp.Services;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MovieModel</span> : <span class="hljs-title">PageModel</span>
        {
            [<span class="hljs-meta">BindProperty</span>]
            <span class="hljs-keyword">public</span> Movie? Movie { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> MoviesService _service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieModel</span>(<span class="hljs-params">MoviesService service</span>)</span> =&gt; _service = service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id</span>)</span>
            {
                Movie = _service.Get(id);
            }
        }
    }
</div></code></pre>
<h4 id="moviesschtmlcs">Movies.schtml.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;
    <span class="hljs-keyword">using</span> MoviesApp.Services;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoviesModel</span> : <span class="hljs-title">PageModel</span>
        {
            <span class="hljs-keyword">public</span> List&lt;Movie&gt;? Movies { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            [<span class="hljs-meta">TempData</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> MoviesService _service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MoviesModel</span>(<span class="hljs-params">MoviesService service</span>)</span> =&gt; _service = service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"></span>)</span>
            {
                Movies = _service.GetAll();
            }
        }
    }
</div></code></pre>
<h4 id="addmoviecshtmlcs">AddMovie.cshtml.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;
    <span class="hljs-keyword">using</span> MoviesApp.Services;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AddMovieModel</span> : <span class="hljs-title">PageModel</span>
        {
            [<span class="hljs-meta">BindProperty</span>]
            <span class="hljs-keyword">public</span> Movie? Movie { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            [<span class="hljs-meta">TempData</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> MoviesService _service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddMovieModel</span>(<span class="hljs-params">MoviesService service</span>)</span> =&gt; _service = service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"></span>)</span>
            {
            }

            <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnPost</span>(<span class="hljs-params"></span>)</span>
            {
                <span class="hljs-keyword">string</span> <span class="hljs-keyword">value</span> = <span class="hljs-string">$"<span class="hljs-subst">{Movie.Title}</span> - <span class="hljs-subst">{Movie.Rate}</span>/10 - <span class="hljs-subst">{Movie.Description}</span>"</span>;

                <span class="hljs-keyword">if</span> (!ModelState.IsValid)
                {
                    <span class="hljs-keyword">return</span> Page();
                }

                Message = <span class="hljs-keyword">value</span>;

                <span class="hljs-keyword">var</span> movie = <span class="hljs-keyword">new</span> Movie()
                {
                    Title = Movie.Title,
                    Rate = Movie.Rate,
                    Description = Movie.Description
                };

                _service.Add(movie);

                <span class="hljs-keyword">return</span> Redirect(<span class="hljs-string">"Movies"</span>);
            }
        }
    }
</div></code></pre>
<p>The next step is to configure the <strong>MoviesService</strong> in Program.cs or we won't be able to inject the service.</p>
<p>After <code>builder.Services.AddRazorPages();</code> add the MoviesService configuration.</p>
<pre class="prettyprint"><code><div>    builder.Services.AddScoped&lt;IMoviesService, MoviesService&gt;();
</div></code></pre>
<p>This basically means that we are going to inject the <code>IMoviesService</code> and the implementation of the <code>IMoviesService</code> is <code>MoviesService</code>.</p>
<p><strong>Note:</strong> there are three different types of services we could add here.</p>
<p>The one we are going to use is the following.</p>
<blockquote>
<p>builder.Services.AddScoped&lt;IMoviesService, MoviesService&gt;();</p>
</blockquote>
<p><strong>AddScoped</strong> means for each page a single reference is going to be made for a service.</p>
<blockquote>
<p>builder.Services.AddTransient&lt;IMoviesService, MoviesService&gt;();</p>
</blockquote>
<p><strong>AddTransient</strong> means each request a new reference is going to be made for a service.</p>
<blockquote>
<p>builder.Services.AddSingleton&lt;IMoviesService, MoviesService&gt;();</p>
</blockquote>
<p><strong>AddSingleton</strong> means create a single reference for a service.</p>
<p>This is all we need to do to configure a service in our Razor pages application.</p>
<h3 id="running-the-application">Running the application</h3>
<p>If we try to run this application we will get an exception.</p>
<p><img src="assets/images/exception.jpg" alt="Exception" title="Exception"></p>
<p>We have to go back and make changes to all of our code pages. Change all of the constructors to <strong>IMovieService</strong> and the private Service string to <strong>IMovieService</strong>.</p>
<h4 id="final-addmoviecshtmlcs">Final AddMovie.cshtml.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;
    <span class="hljs-keyword">using</span> MoviesApp.Services;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AddMovieModel</span> : <span class="hljs-title">PageModel</span>
        {
            [<span class="hljs-meta">BindProperty</span>]
            <span class="hljs-keyword">public</span> Movie? Movie { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            [<span class="hljs-meta">TempData</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> IMoviesService _service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddMovieModel</span>(<span class="hljs-params">IMoviesService service</span>)</span> =&gt; _service = service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"></span>)</span>
            {

            }

            <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">OnPost</span>(<span class="hljs-params"></span>)</span>
            {
                <span class="hljs-keyword">string</span> <span class="hljs-keyword">value</span> = <span class="hljs-string">$"<span class="hljs-subst">{Movie.Title}</span> - <span class="hljs-subst">{Movie.Rate}</span>/10 - <span class="hljs-subst">{Movie.Description}</span>"</span>;

                <span class="hljs-keyword">if</span> (!ModelState.IsValid)
                {
                    <span class="hljs-keyword">return</span> Page();
                }

                Message = <span class="hljs-keyword">value</span>;

                <span class="hljs-keyword">var</span> movie = <span class="hljs-keyword">new</span> Movie()
                {
                    Title = Movie.Title,
                    Rate = Movie.Rate,
                    Description = Movie.Description
                };

                _service.Add(movie);

                <span class="hljs-keyword">return</span> Redirect(<span class="hljs-string">"Movies"</span>);
            }
        }
    }
</div></code></pre>
<h4 id="final-moviescshtmlcs">Final Movies.cshtml.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;
    <span class="hljs-keyword">using</span> MoviesApp.Services;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoviesModel</span> : <span class="hljs-title">PageModel</span>
        {
            <span class="hljs-keyword">public</span> List&lt;Movie&gt;? Movies { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            [<span class="hljs-meta">TempData</span>]
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> IMoviesService _service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MoviesModel</span>(<span class="hljs-params">IMoviesService service</span>)</span> =&gt; _service = service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"></span>)</span>
            {
                Movies = _service.GetAll();
            }
        }
    }
</div></code></pre>
<h4 id="final-moviecshtmlcs">final Movie.cshtml.cs</h4>
<pre class="prettyprint"><code><div>    <span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc.RazorPages;
    <span class="hljs-keyword">using</span> MoviesApp.Data;
    <span class="hljs-keyword">using</span> MoviesApp.Data.Models;
    <span class="hljs-keyword">using</span> MoviesApp.Services;

    <span class="hljs-keyword">namespace</span> <span class="hljs-title">MoviesApp.Pages</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MovieModel</span> : <span class="hljs-title">PageModel</span>
        {
            [<span class="hljs-meta">BindProperty</span>]
            <span class="hljs-keyword">public</span> Movie? Movie { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

            <span class="hljs-keyword">private</span> IMoviesService _service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieModel</span>(<span class="hljs-params">IMoviesService service</span>)</span> =&gt; _service = service;

            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnGet</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id</span>)</span>
            {
                Movie = _service.Get(id);
            }
        }
    }
</div></code></pre>
<p>Making these minor changes will get your application injecting the MoviesServices properly.</p>


</div><!-- starter-template -->
</div><!-- /.container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"/>
<script>hljs.initHighlightingOnLoad();</script>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
</body>
</html>